#!/bin/bash
# Git post-checkout hook - Fetch coding principles after branch checkout
# This hook runs automatically after git checkout or git switch

# Only run on branch checkouts, not file checkouts
# $3 is 1 for branch checkout, 0 for file checkout
if [ "$3" != "1" ]; then
  exit 0
fi

# Find the fetch-principles.sh script
SCRIPT_DIR="$(dirname "$0")"
FETCH_SCRIPT=""

# Try multiple locations
for path in \
  "$SCRIPT_DIR/fetch-principles.sh" \
  "$SCRIPT_DIR/../fetch-principles.sh" \
  "$SCRIPT_DIR/../../hooks/fetch-principles.sh"; do
  if [ -f "$path" ]; then
    FETCH_SCRIPT="$path"
    break
  fi
done

# Run fetch-principles.sh in background if found
if [ -n "$FETCH_SCRIPT" ] && [ -f "$FETCH_SCRIPT" ]; then
  bash "$FETCH_SCRIPT" &>/dev/null &
fi

# Chain to original hook if backed up
if [ -f "$0.backup-original" ]; then
  exec "$0.backup-original" "$@"
fi
