#!/bin/bash
# Git pre-commit hook - Format and lint staged files before commit
# This hook runs automatically before git commit

# Find the format-lint.sh script
SCRIPT_DIR="$(dirname "$0")"
FORMAT_SCRIPT=""

# Try multiple locations
for path in \
  "$SCRIPT_DIR/format-lint.sh" \
  "$SCRIPT_DIR/../format-lint.sh" \
  "$SCRIPT_DIR/../../hooks/format-lint.sh"; do
  if [ -f "$path" ]; then
    FORMAT_SCRIPT="$path"
    break
  fi
done

# Run format-lint if found
if [ -n "$FORMAT_SCRIPT" ] && [ -f "$FORMAT_SCRIPT" ]; then
  FORMAT_LINT_MODE=fix bash "$FORMAT_SCRIPT"
  exit_code=$?

  if [ $exit_code -ne 0 ]; then
    echo "[pre-commit] Formatting/linting failed. Please fix errors and try again."
    echo "[pre-commit] To skip this check, use: git commit --no-verify"
    exit $exit_code
  fi
fi

# Chain to original hook if backed up
if [ -f "$0.backup-original" ]; then
  exec "$0.backup-original" "$@"
fi
